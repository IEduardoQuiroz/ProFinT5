<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modelo T5 - Asistente IA</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-100 via-white to-purple-100 min-h-screen flex flex-col items-center justify-center p-6">

<!-- Pantalla de carga inicial -->
<div id="loadingScreen" class="flex flex-col items-center justify-center h-screen">
    <h1 class="text-4xl font-bold text-gray-800 mb-4">Cargando Modelo T5...</h1>
    <p class="text-center max-w-xl text-gray-700">El modelo T5 (Text-to-Text Transfer Transformer) permite realizar tareas como resumen de texto, traducción, generación y respuesta de preguntas, e incluso crear imágenes a partir de descripciones.</p>
    <div class="mt-6 animate-spin rounded-full h-12 w-12 border-t-4 border-b-4 border-blue-500"></div>
</div>

<!-- Página principal -->
<div id="mainPage" class="hidden w-full max-w-3xl bg-white p-6 rounded-xl shadow-lg">
    <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">Selecciona una tarea</h1>

    <div id="botones" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
        <button onclick="mostrarFormulario('resumir')" class="px-6 py-3 bg-blue-500 text-white rounded-lg shadow hover:bg-blue-600">Resumir texto</button>
        <button onclick="mostrarFormulario('traducir')" class="px-6 py-3 bg-green-500 text-white rounded-lg shadow hover:bg-green-600">Traducir a francés</button>
        <button onclick="mostrarFormulario('preguntar')" class="px-6 py-3 bg-yellow-500 text-white rounded-lg shadow hover:bg-yellow-600">Responder una pregunta</button>
        <button onclick="mostrarFormulario('generar_preguntas')" class="px-6 py-3 bg-purple-500 text-white rounded-lg shadow hover:bg-purple-600">Generar preguntas</button>
        <button onclick="mostrarFormulario('generar_imagen')" class="px-6 py-3 bg-indigo-500 text-white rounded-lg shadow hover:bg-indigo-600 col-span-full">Generar imagen</button>
    </div>

    <!-- Formulario dinámico -->
    <div id="formulario" class="hidden flex flex-col items-center">
        <textarea id="entrada" rows="4" class="w-full p-3 border rounded mb-4 resize-none shadow-sm" placeholder="Escribe aquí tu texto o descripción..."></textarea>
        <input id="contexto" class="w-full p-3 border rounded mb-4 shadow-sm hidden" placeholder="(Solo para responder preguntas: contexto adicional)">
        <button id="btnProcesar" onclick="procesar()" class="px-6 py-2 bg-black text-white rounded shadow hover:bg-gray-800">Procesar</button>
    </div>

    <!-- Indicador de carga textual -->
    <div id="cargando" class="hidden flex items-center justify-center space-x-3 mt-6">
        <div class="animate-spin h-6 w-6 border-4 border-blue-400 border-t-transparent rounded-full"></div>
        <span class="text-blue-700 font-medium">Generando respuesta, por favor espera...</span>
    </div>

    <!-- Barra de progreso para imágenes -->
    <div id="barraImagen" class="hidden w-full mt-6">
        <p class="text-center text-sm text-gray-600 mb-1">Generando imagen...</p>
        <div class="w-full bg-gray-200 rounded-full h-4">
            <div id="progreso" class="bg-indigo-500 h-4 rounded-full text-right text-white text-xs px-1 leading-4" style="width: 0%">0%</div>
        </div>
    </div>

    <!-- Resultado -->
    <div id="resultado" class="mt-6 text-left text-gray-800"></div>

    <!-- Imagen generada -->
    <div id="contenedorImagen" class="mt-6 hidden w-full flex justify-center">
        <img id="imagenGenerada" src="" class="rounded-xl shadow max-w-full border border-gray-300">
    </div>
</div>

<script>
    let tipo = '';
    let intervaloProgreso;

    function mostrarFormulario(seleccion) {
        tipo = seleccion;
        document.getElementById('formulario').classList.remove('hidden');
        document.getElementById('entrada').value = '';
        document.getElementById('contexto').value = '';
        document.getElementById('resultado').innerHTML = `<p class='font-semibold text-lg text-blue-800'>Opción seleccionada: ${tipo.replace('_', ' ')}</p>`;

        document.getElementById('barraImagen').classList.add('hidden');
        document.getElementById('progreso').style.width = '0%';
        document.getElementById('progreso').innerText = '0%';
        document.getElementById('contenedorImagen').classList.add('hidden');

        if (tipo === 'preguntar') {
            document.getElementById('contexto').classList.remove('hidden');
        } else {
            document.getElementById('contexto').classList.add('hidden');
        }
    }

    function bloquearInteraccion(bloquear) {
        const botones = document.querySelectorAll('button');
        botones.forEach(btn => btn.disabled = bloquear);
    }

    function simularProgreso() {
        let progreso = 0;
        const barra = document.getElementById('progreso');
        intervaloProgreso = setInterval(() => {
            if (progreso < 95) {
                progreso++;
                barra.style.width = progreso + '%';
                barra.innerText = progreso + '%';
            } else {
                clearInterval(intervaloProgreso);
            }
        }, 100);
    }

    function procesar() {
        const texto = document.getElementById('entrada').value;
        const contexto = document.getElementById('contexto').value;
        const cargando = document.getElementById('cargando');

        cargando.classList.remove('hidden');
        bloquearInteraccion(true);

        if (tipo === 'generar_imagen') {
            document.getElementById('barraImagen').classList.remove('hidden');
            simularProgreso();
        }

        fetch('/procesar', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ tipo, texto, contexto })
        })
        .then(res => res.json())
        .then(data => {
            const resDiv = document.getElementById('resultado');
            let html = "";
            if (data.resultado) {
                html += `<p class='mt-4'><strong>Resultado:</strong> ${data.resultado}</p>`;
            } else if (data.preguntas) {
                html += '<p class="mt-4 font-semibold">Preguntas generadas:</p><ul class="list-disc list-inside">' + data.preguntas.map(p => `<li>${p}</li>`).join('') + '</ul>';
            } else if (data.imagen) {
                clearInterval(intervaloProgreso);
                document.getElementById('progreso').style.width = '100%';
                document.getElementById('progreso').innerText = '100%';
                document.getElementById('contenedorImagen').classList.remove('hidden');
                document.getElementById('imagenGenerada').src = `/${data.imagen}?t=${new Date().getTime()}`;
            }
            resDiv.innerHTML += html;
        })
        .catch(err => {
            document.getElementById('resultado').innerHTML += `<p class='text-red-600 mt-4'>Ocurrió un error. Intenta nuevamente.</p>`;
        })
        .finally(() => {
            cargando.classList.add('hidden');
            bloquearInteraccion(false);
        });
    }

    window.addEventListener('load', function () {
        setTimeout(function () {
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('mainPage').classList.remove('hidden');
        }, 3000);
    });
</script>

</body>
</html>